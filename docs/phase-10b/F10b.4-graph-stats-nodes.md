# F10b.4 Fix get_graph_stats Node Counting

**Phase**: 10b - MCP Tool Fixes
**Priority**: High
**Dependencies**: None

## Problem

`get_graph_stats` returns `totalNodes: 0` but `totalEdges: 54` — contradictory since edges require nodes.

### Root Cause

In `CoreService.getGraphStats()` (line 500), `totalNodes` is hardcoded to `0` with the comment `// Would need entity count`. The entity count is available from EntityStore but was never wired up.

```typescript
return {
  totalNodes: 0, // Would need entity count  ← BUG
  totalEdges,
  averageDegree: avgDegree,
  byType: stats
};
```

## Implementation Plan

### Step 1: Count Nodes from Entity Store

**File**: `src/services/core-service.ts` (lines 493-505)

```typescript
async getGraphStats(projectId: string): Promise<GraphStats> {
  const entityStore = this.context.getEntityStore(projectId);
  const relationshipStore = this.getRelationshipStore(projectId);

  const totalNodes = await entityStore.count();
  const totalEdges = await relationshipStore.count();
  const stats = await relationshipStore.getStatsByType();
  const avgDegree = await relationshipStore.getAverageDegree();

  return {
    totalNodes,
    totalEdges,
    averageDegree: avgDegree,
    byType: stats
  };
}
```

## Testing

```typescript
describe('get_graph_stats', () => {
  it('should return non-zero node count when entities exist', async () => {
    const result = await mcp.call('get_graph_stats', { project: 'ctx-sys' });
    expect(result.totalNodes).toBeGreaterThan(0);
    expect(result.totalEdges).toBeGreaterThan(0);
  });

  it('should have consistent node/edge relationship', async () => {
    const result = await mcp.call('get_graph_stats', { project: 'ctx-sys' });
    // Can't have edges without nodes
    if (result.totalEdges > 0) {
      expect(result.totalNodes).toBeGreaterThan(0);
    }
  });
});
```

## Success Criteria

- `totalNodes` reflects actual entity count
- Node count is always >= 0 and consistent with edge count
