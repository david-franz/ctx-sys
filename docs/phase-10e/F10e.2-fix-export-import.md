# F10e.2 Fix Export/Import to Include Vectors and Content

**Phase**: 10e - Knowledge Bases & Long-Term Context
**Priority**: Critical
**Dependencies**: None

## Problem

The current export command (`src/cli/debug.ts:264-327`) has two critical gaps that make exported data useless for distribution:

1. **Vectors table skipped**: Export does not include `{prefix}_vectors`, so semantic search breaks on import. This is the most important table for knowledge base sharing.

2. **Entity content dropped on import**: The import INSERT statement (`debug.ts:366-374`) maps columns explicitly but **omits the `content` column**. All entity content is lost on round-trip.

Additionally:
- Checkpoints, memory items, reflections, and AST cache are not exported
- No metadata about the export (schema version, embedding model, entity count)
- SQL format generates incorrect table names (prepends `{prefix}_` to already-prefixed keys)

## Implementation

### File: `src/cli/debug.ts`

#### Fix `exportData()`

1. **Add vectors to export**: Always export `{prefix}_vectors` alongside entities
2. **Add export metadata header**:
   ```json
   {
     "_meta": {
       "version": "1.0",
       "exportedAt": "2026-02-08T...",
       "projectId": "ctx-sys",
       "schemaVersion": 1,
       "embeddingModel": "nomic-embed-text",
       "counts": { "entities": 450, "vectors": 380, "relationships": 1200 }
     },
     "entities": [...],
     "vectors": [...],
     "relationships": [...],
     "sessions": [...],
     "messages": [...]
   }
   ```
3. **Optional full export**: Add `--full` flag to also include checkpoints, memory items, reflections
4. **Fix SQL format**: Use actual table names, not `{prefix}_{key}`

#### Fix `importData()`

1. **Include content column**: Add `content` and `metadata` to the entity INSERT:
   ```typescript
   db.run(`
     INSERT OR REPLACE INTO ${prefix}_entities
     (id, qualified_name, name, type, content, summary, metadata,
      file_path, start_line, end_line, hash, created_at, updated_at)
     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
   `, [
     entity.id, entity.qualified_name, entity.name, entity.type,
     entity.content, entity.summary, entity.metadata,
     entity.file_path, entity.start_line, entity.end_line,
     entity.hash, entity.created_at, entity.updated_at
   ]);
   ```

2. **Import vectors**: Read `data.vectors` and insert into `{prefix}_vectors`:
   ```typescript
   db.run(`
     INSERT OR REPLACE INTO ${prefix}_vectors
     (id, entity_id, model_id, embedding, content_hash, created_at)
     VALUES (?, ?, ?, ?, ?, ?)
   `, [v.id, v.entity_id, v.model_id, v.embedding, v.content_hash, v.created_at]);
   ```

3. **Validate metadata**: On import, check `_meta.version` for compatibility. Warn if embedding model differs from current config.

### CLI Changes

```
ctx-sys export <output> [--full] [--format json|sql]
ctx-sys import <input> [--merge] [--force]
```

`--force` skips the embedding model mismatch warning.

## Success Criteria

- `ctx-sys export data.json` produces JSON with entities, vectors, relationships, sessions, messages, and `_meta`
- `ctx-sys import data.json` restores all data including content and vectors
- `ctx-sys search "EmbeddingManager"` works after import (entities have content)
- `ctx-sys context "EmbeddingManager"` returns semantic results after import (vectors present)
- Round-trip: export → delete project → re-create → import → same search results
