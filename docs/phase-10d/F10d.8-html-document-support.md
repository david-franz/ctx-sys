# F10d.8 HTML Document Indexing

**Phase**: 10d - Bug Fixes & Cleanup
**Priority**: Medium
**Dependencies**: None (extends existing DocumentIndexer)

## Problem

The DocumentIndexer supports markdown, YAML, JSON, TOML, and plain text but not HTML. Users may have HTML documentation (generated API docs, exported pages, etc.) that should be searchable.

**Already supported:** `.md`, `.mdx`, `.yaml`, `.yml`, `.json`, `.toml`, `.txt`, `.log`
**Missing:** `.html`, `.htm`

## Implementation

### File: `src/documents/document-indexer.ts`

1. **Add `'html'` to `DocumentType` union:**
```typescript
type DocumentType = 'markdown' | 'yaml' | 'json' | 'toml' | 'html' | 'text';
```

2. **Add to `EXTENSION_MAP`:**
```typescript
'.html': 'html',
'.htm': 'html',
```

3. **Add case to `indexFile()` switch:**
```typescript
case 'html':
  return this.indexHtml(absolutePath, content, hash);
```

4. **Implement `indexHtml()` method:**

**HTML parsing approach** â€” dependency-free, regex-based:
- Strip `<script>` and `<style>` blocks entirely
- Strip HTML comments
- Extract `<title>` for document name
- Extract text content by stripping all tags
- Split on `<h1>`-`<h6>` tags to create section entities
- Create document entity + section entities with CONTAINS relationships
- Run through `documentLinker.findCodeReferences()` for code linking

**Section extraction:**
- Use regex to find `<h[1-6]>` headings
- Capture content between headings as section body
- Create section entities with `qualifiedName: filePath::section-slug`

**Code reference linking:**
- Build a minimal `MarkdownDocument` from the extracted text
- Pass to `documentLinker.findCodeReferences()` to detect backtick references, file paths, class names
- Create DOCUMENTS relationships for resolved references

This avoids adding a heavy HTML parser dependency. For production use, a library like `cheerio` could be added later.

## Testing

```bash
# Index an HTML file
ctx-sys index-doc some-page.html

# Index a directory with HTML files
ctx-sys index . --doc  # Should now pick up .html/.htm files

# Search for content from HTML docs
ctx-sys search "api reference" --type section
ctx-sys context "api reference"
```

## Success Criteria

- `.html` and `.htm` files recognized by `EXTENSION_MAP`
- HTML tags stripped; text content properly extracted
- Heading-based sections created as child entities with CONTAINS relationships
- Code references in HTML docs linked to code entities via DOCUMENTS relationships
- `ctx-sys index . --doc` picks up HTML files alongside markdown
- `DocumentIndexer.getSupportedExtensions()` includes `.html` and `.htm`
