# F11.3 Telemetry & Analytics

**Phase**: 11 - Commercial Desktop & Enterprise
**Priority**: Medium
**Dependencies**: F9.5 NPM Package Distribution

## Goal

Understand how users interact with the system, identify retrieval failures, and track retention metrics while respecting user privacy.

## Overview

For a local-first tool, "blindness" is a major risk. We need to know if the indexer is crashing or if queries are returning zero results. However, we must **NEVER** transmit user code or query content.

## Tech Stack

- **Platform**: PostHog (Open source, can self-host if needed, great privacy controls).

## Privacy Policy (Code of Conduct)
1. **No Code Content**: We never log file contents, function names, or variable names.
2. **No Query Content**: We log "Query Length" or "Query Type" (e.g., "decision search"), but NOT the text.
3. **Opt-Out**: Prominent "Disable Telemetry" toggle in CLI/Desktop App.

## Metrics to Track

### 1. Performance (Health)
- **Indexing Duration**: Time per 1k lines of code.
- **Crash Rate**: Uncaught exceptions in Node process.
- **Startup Time**: Time to ready state.

### 2. Value (usage)
- **Queries Per Session**: Are users asking follow-up questions?
- **Zero-Result Rate**: % of queries that returned empty context.
- **Tool Usage**: Distribution of Vector vs. Graph vs. Keyword search usage.

### 3. Activation
- **Time to First Query**: Seconds between install and first successful interaction.

## Implementation Plan

1. **Telemetry Client**: Create a wrapper around PostHog Node client with strict sanitization limits.
2. **Injection**: Add telemetry hooks to `McpServer` request handlers and `CodebaseIndexer`.
3. **User Config**: Add `telemetry.enabled` boolean to global config.
4. **Dashboard**: Set up internal PostHog viewing dashboards for the team.
