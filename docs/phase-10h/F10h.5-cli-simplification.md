# F10h.5: CLI Simplification

**Phase**: 10h - Infrastructure & Performance
**Priority**: Medium
**Dependencies**: F10h.4 (smarter defaults)

## Problem

The CLI had 36 top-level commands, making `--help` overwhelming and discovery difficult. Many commands were niche (debug tools, embedding management) and cluttered the main interface.

## Solution

Restructured to 7 core commands + 9 subcommand groups.

### Core Commands (top-level)

| Command | Description |
|---------|-------------|
| `init [dir]` | Initialize project configuration |
| `index [dir]` | Index codebase (code + docs + embeddings by default) |
| `search <query>` | Search with semantic + keyword by default |
| `context <query>` | Assembled context with expansion by default |
| `status [dir]` | Project info; `--check` for full health diagnostics |
| `serve` | Start MCP server |
| `watch [dir]` | Watch for changes and auto-reindex |

### Subcommand Groups

| Group | Subcommands | Description |
|-------|-------------|-------------|
| `entity` | list, get, delete, stats, extract-rel | Manage indexed entities |
| `graph` | query, stats, relationships, link | Explore relationship graph |
| `embed` | run, status, cleanup | Manage embeddings |
| `summarize` | run, status, providers | LLM summarization |
| `session` | list, messages, search-decisions | Conversation sessions |
| `config` | get, set, show | Configuration management |
| `debug` | inspect, query, export, import, health | Database tools |
| `kb` | create, install, list | Knowledge base packaging |
| `instruction` | add, list, apply | Team instructions |

### Commands Removed or Moved

| Old Command | New Location |
|-------------|-------------|
| `doctor` | `status --check` |
| `doc-index <path>` | `index --doc-path <path>` |
| `extract-relationships` | `entity extract-relationships` |
| `inspect` (top-level) | `debug inspect` |
| `query` (top-level) | `debug query` |
| `export` (top-level) | `debug export` |
| `import` (top-level) | `debug import` |
| `health` (top-level) | `debug health` |
| `entities` (top-level) | `entity list` |
| `entity-stats` (top-level) | `entity stats` |
| `entity-delete` (top-level) | `entity delete` |
| `graph-stats` (top-level) | `graph stats` |
| `relationships` (top-level) | `graph relationships` |
| `link` (top-level) | `graph link` |
| `embed-status` (top-level) | `embed status` |
| `embed-cleanup` (top-level) | `embed cleanup` |
| `summarize-status` (top-level) | `summarize status` |
| `providers` (top-level) | `summarize providers` |
| `sessions` (top-level) | `session list` |
| `messages` (top-level) | `session messages` |
| `search-decisions` (top-level) | `session search-decisions` |

### Merging Doctor into Status

The `doctor` command's health check functions are now exported from `src/cli/doctor.ts` and reused by `status.ts`:

```
ctx-sys status           # Quick project info (no network calls)
ctx-sys status --check   # Full health diagnostics (checks Ollama, models, DB, config, project)
```

This keeps `status` fast by default while providing the full diagnostic experience behind `--check`.

## Files Changed

- `src/cli/index.ts` — complete rewrite of command registration
- `src/cli/status.ts` — add `--check` flag, import doctor check functions
- `src/cli/doctor.ts` — export check functions and formatCheck helper

## Not Backwards Compatible

This change intentionally breaks existing CLI usage. The user confirmed this is acceptable since they are the sole user and the tool is pre-1.0.
